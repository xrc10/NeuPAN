# 渲染优化说明

## 主要改进

### 1. 修复左右反转问题
- **问题**：原来的坐标系转换导致左右方向反转
- **解决方案**：修正相机坐标系的y轴方向（右侧为正）
- **改进位置**：`_render_first_person_frame()` 中的坐标转换

### 2. 增强地面运动感
- **更密集的网格**：将网格间距从2.0米减少到1.0米
- **主网格线突出显示**：每5条线使用更亮的颜色和更粗的线条
- **中央参考线**：添加虚线显示机器人前进方向
- **距离衰减**：根据距离调整网格线的透明度
- **改进位置**：`_draw_ground_grid()`

### 3. 改进天空和地面渲染
- **天空渐变**：从深蓝色（顶部）到浅蓝色（地平线）
- **地面渐变**：从浅绿色（近处）到深绿色（远处）
- **相机俯仰**：向下倾斜5度，更好地观察地面
- **改进位置**：`_render_first_person_frame()`

### 4. 改进3D障碍物渲染

#### 多边形障碍物
- **法向量光照**：基于面的法向量计算光照强度
- **方向性光源**：模拟从右上方照射的光源
- **距离衰减**：根据距离调整亮度
- **阴影效果**：在底部边缘添加阴影
- **改进位置**：`_draw_polygon_obstacle()`

#### 圆形障碍物
- **分段渐变**：使用36个分段，每段根据角度计算光照
- **更自然的高光**：改进高光位置和大小
- **更柔和的阴影**：地面阴影更加自然
- **顶部椭圆**：更明显的顶部平面
- **改进位置**：`_draw_circle_obstacle()`

### 5. 改进UI显示
- **更详细的信息**：显示位置、角度、速度等
- **方向指示器**：右上角添加指南针显示当前朝向
- **文字阴影**：增强文字可读性
- **更大的信息面板**：容纳更多信息
- **改进位置**：`_draw_ui_info()` 和新增 `_draw_direction_indicator()`

### 6. 改进视频质量
- **更好的编码器**：优先使用H.264编码
- **帧平滑**：应用高斯模糊减少锯齿
- **关键帧保存**：每10帧保存一张图片
- **改进位置**：`render_first_person_video()`

### 7. 改进透视投影
- **更准确的焦距**：基于FOV计算焦距
- **边界检查**：防止投影坐标超出屏幕范围
- **改进位置**：`_project_to_screen_y()` 和 `_project_to_screen_y_with_height()`

## 使用方法

### 基本用法
```bash
python example/render2Dto3D.py -i render_data/episode_data.json -o navigation_data
```

### 自定义参数
```bash
python example/render2Dto3D.py \
  -i render_data/episode_data.json \
  -o navigation_data \
  --seed 100 \
  --scene_id 0 \
  --episode_id 0 \
  --fps 10 \
  --width 640 \
  --height 480
```

## 渲染参数调整建议

### 如果地面运动感仍不够明显
- 减小 `grid_size`（当前1.0米）
- 增加网格线的对比度
- 增加中央参考线的密度

### 如果障碍物看起来不够立体
- 调整光源方向（`light_dir`）
- 增加分段数量（圆形障碍物）
- 调整亮度范围

### 如果视频质量不够好
- 增加图像分辨率（`--width` 和 `--height`）
- 调整高斯模糊参数
- 修改JPEG质量（当前95）

## 技术细节

### 坐标系统
- **世界坐标系**：X向右，Y向上（俯视图）
- **相机坐标系**：X向前，Y向右，Z向上
- **屏幕坐标系**：X向右，Y向下

### 光照模型
- 使用简化的Lambert光照模型
- 光源位置：右上方（0.7, 0.3）
- 环境光：0.3-0.4

### 透视投影
- FOV：90度（可调整）
- 相机高度：1.2米
- 相机俯仰：-5度
- 可视距离：50米

## 后续改进建议

1. **添加动态模糊**：模拟快速移动时的运动模糊
2. **环境光遮蔽**：增加更真实的阴影效果
3. **纹理映射**：为障碍物添加纹理
4. **粒子效果**：碰撞时的视觉反馈
5. **小地图**：在UI中添加实时小地图
